# Начальная настройка проекта Laravel

После того как Вы создали проект, вам необходимо настроить его. В этом разделе мы рассмотрим, какие первые шаги необходимо предпринять для начальной настройки проекта Laravel.

Вскоре, по мере изучения фреймворка, вы узнаете о других настройках и возможностях Laravel.

## Файл окружения `.env`

Перед тем, как понять, что такое `.env`, необходимо понять, что такое переменные окружения. 

**Переменные окружения** — это переменные, которые хранятся в операционной системе и доступны для всех процессов (программ), запущенных в этой операционной системе. 

`.env` — это файл, в котором хранятся переменные окружения для вашего проекта. В Laravel используется механизм, который автоматически загружает эти переменные в окружение при запуске приложения.

> [!NOTE]
> **Окружение** — это среда, в которой работает ваше приложение, например, _разработка_, _тестирование_ или _продакшен_. В зависимости от окружения могут меняться такие параметры, как база данных, сервер, настройки безопасности, кэширование и другие.

### Зачем нужен `.env`?

Файл `.env` используется для хранения конфиденциальной информации, такой как пароли, ключи и другие параметры, которые могут меняться в зависимости от окружения (например, разработка, тестирование, продакшен). Это позволяет избежать размещения таких данных в коде и хранить их отдельно от репозитория [^1].

Важно помнить, что файл `.env` не должен загружаться в репозиторий. Вместо него в репозитории должен быть файл `.env.example`, содержащий список всех необходимых переменных окружения для работы приложения.

Разработчики, работающие с проектом, должны создать свой собственный файл `.env` на основе `.env.example` и настроить его в соответствии со своей рабочей средой.

Представьте, что у вас есть проект, использующий базу данных. 

Для его работы необходимо указать параметры подключения, такие как имя базы данных, пользователь и пароль. Если над проектом работает команда разработчиков, каждый может настроить свой собственный файл `.env` с индивидуальными параметрами подключения к базе данных. Кроме того, будет существовать отдельный файл `.env` для продакшена, в котором указываются параметры подключения к базе данных для рабочей среды.

### Структура файла `.env` [^2]

Файл `.env` представляет собой текстовый файл, в котором каждая строка содержит одну переменную окружения в формате `ключ=значение`.

Настройка основных переменных окружения в файле `.env`:

```plaintext
APP_NAME=Laravel
APP_ENV=local
APP_KEY=base64:qWv3Z
APP_DEBUG=true
APP_URL=http://localhost
```

> [!NOTE]
> Если значение переменной окружения содержит пробелы, то его необходимо заключить в двойные кавычки.
> Например: `APP_NAME="My Laravel App"`

Рассмотрим некоторые _переменные окружения_:

- `APP_NAME` — название вашего приложения.
- `APP_ENV` — окружение вашего приложения (например, `local`, `testing`, `production`).
- `APP_KEY` — ключ приложения, используемый для шифрования данных (можно сгенерировать с помощью команды `php artisan key:generate`).
- `APP_DEBUG` — режим отладки приложения.
  - `true` — включен режим отладки.
  - `false` — отключен режим отладки.
- `APP_URL` — URL вашего приложения.

Эти переменные используются во многих частях вашего приложения, поэтому важно правильно настроить их. 

> [!NOTE]
> Остальные переменные окружения мы рассмотрим в следующих разделах.

### Дополнительные файлы окружения

В Laravel можно создавать дополнительные файлы окружения для различных окружений.

Например, для окружения `testing` можно создать файл `.env.testing` и указать в нем параметры для тестирования.

Как думаете какие переменные среды могут быть в файле `.env.testing`? Например, это может быть параметры подключения к тестовой базе данных, которая будет использоваться для тестирования приложения.

## Директория `storage`

Когда вы начинаете новый проект на Laravel, вам необходимо настроить директорию `storage`.

Директория `storage` используется для хранения временных файлов, кэша, сессий, логов и других данных, которые генерируются в процессе работы приложения.

### Права доступа

Для корректной работы приложения необходимо установить правильные права доступа к директории `storage`.

Для этого выполните следующую команду. Данная команда установит права доступа `775` для директории `storage`, то есть простыми словами у Laravel будет доступ на запись в эту директорию и ее поддиректории.

```sh
chmod -R 775 storage
```

### Символическая ссылка

### Символическая ссылка на папку `storage`

Когда вы загружаете файлы через ваше Laravel-приложение, они по умолчанию сохраняются в папке `storage/app/public`.

> [!NOTE]
> По мере роста проекта загруженные файлы могут занимать много места. Чтобы избежать переполнения сервера, можно перенести файлы на внешние облачные хранилища, такие как Amazon S3 или Google Cloud Storage, использовать отдельные серверы для хранения, либо настроить хранение в других директориях вне папки `storage`.

Однако эти файлы по умолчанию недоступны для просмотра через браузер, так как мы говорили, что доступные файлы должны находиться в папке `public`. 

Чтобы это исправить, Laravel использует **символическую ссылку** (или коротко — "симлинк").

#### Что такое символическая ссылка? [^3]

Представьте символическую ссылку как ярлык или мост между двумя папками. В нашем случае, симлинк создаёт связь между папкой `storage/app/public` и папкой `public/storage`. Это значит, что когда браузер будет обращаться к файлам по пути `public/storage`, на самом деле он будет получать их из папки `storage/app/public`. Таким образом, вы можете загружать файлы и делать их доступными для пользователей, но сами файлы физически остаются в папке `storage`.

#### Зачем нужен симлинк?

Когда Laravel работает с файлами (например, изображениями или документами), они хранятся в папке `storage`, которая не доступна напрямую через браузер по соображениям безопасности. Ведь в папке `storage` могут быть конфиденциальные данные. Но если нужно, чтобы пользователи могли просматривать или скачивать загруженные файлы, мы создаём этот "ярлык", чтобы связать безопасную папку `storage` с публичной папкой `public/storage`, доступной через веб [^4].

#### Как создать симлинк?

Чтобы создать символическую ссылку, вы используете команду в Laravel:

```bash
php artisan storage:link
```

 Теперь все файлы, которые вы загрузите через ваше приложение, будут доступны по ссылке вида `http://my-site.com/storage/my_file`.

#### Пример:
1. Вы загружаете изображение через ваше приложение, оно сохраняется в папке `storage/app/public/images/my_file.jpg`.
2. Благодаря символической ссылке это изображение становится доступным по адресу `http://my-site.com/storage/images/my_file.jpg`.

#### Зачем это всё?
- **Безопасность**: Вы можете хранить конфиденциальные данные в папке `storage` и быть уверенным, что они не будут доступны извне.
- **Удобство**: Симлинк позволяет сделать публичные файлы доступными через браузер, сохраняя упорядоченность файловой структуры.

Таким образом, _символическая ссылка_ — это способ безопасно и эффективно управлять файлами, которые нужно сделать доступными для пользователей вашего приложения.

## Выводы

В этом разделе мы рассмотрели начальную настройку проекта Laravel, которая включает в себя настройку файла `.env` и директории `storage`.

В дальнейшем вы узнаете о других настройках, которые понадобятся вам при работе с фреймворком.

[^1]: What is .env ? codementor.io [online]. Available at: https://www.codementor.io/@parthibakumarmurugesan/what-is-env-how-to-set-up-and-run-a-env-file-in-node-1pnyxw9yxj

[^2]: Laravel Configuration, laravel.com [online]. Available at: https://laravel.com/docs/101.x/configuration#environment-configuration

[^3]: Symbolic Link, komprise [online]. Available at: https://www.komprise.com/glossary_terms/symbolic-link/

[^4]: File Storage, laravel.com [online]. Available at: https://laravel.com/docs/10.x/filesystem