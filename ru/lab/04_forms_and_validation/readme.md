# Лабораторная работа №4. Формы и валидация данных

    ## Цель работы

    Познакомиться с основами создания и управления формами в **Laravel**.

    Освоить механизмы валидации данных на сервере, использовать предустановленные и кастомные правила валидации, а также научиться обрабатывать ошибки и обеспечивать безопасность данных.

    ## Условие

    В данной лабораторной работе вы создадите HTML-формы, реализуете проверку данных на стороне сервера и обеспечите безопасное взаимодействие с пользователем, предотвращая уязвимости, такие как **XSS** и **CSRF**.

    > [!NOTE]
    > В данной лабораторной работе вы можете продолжать свою прошлую работу или начать новый проект.

    ### №1. Подготовка к работе

    1. Создайте новый проект Laravel (если не установлен) или продолжите работу с прошлым проектом.
    2. Обновите переменные окружения в `.env`, если требуется подключение к базе данных.

    ### №2. Создание формы

    1. Создайте форму для добавления новой задачи:
    1. Форма должна содержать следующие поля: `Название`, `Описание`, `Дата выполнения`, `Категория`.
    2. Используйте Blade-шаблоны для рендеринга формы
    3. Поле `Категория` должно быть выпадающим списком, загруженным из таблицы категорий в базе данных.
    4. Обеспечьте, чтобы форма отправляла данные методом **POST** на маршрут, созданный для обработки данных.
    2. Создайте маршрут `POST /tasks` для сохранения данных из формы в базе данных. Для удобства можно использовать ресурсный контроллер.
    3. Обновите контроллер `TaskController`
    1. Добавьте метод `create`, который возвращает представление с формой.
    2. Добавьте метод `store`, который обрабатывает данные из формы и сохраняет их.

    ### №3. Валидация данных на стороне сервера

    1. Реализуйте валидацию данных непосредственно в методе `store` контроллера `TaskController`.
    2. Требования к полям:
    - `title` — обязательное, строка, минимальная длина 3 символа.
    - `description` — строка, необязательно, максимальная длина 500 символов.
    - `due_date` — обязательное, дата, должна быть не меньше сегодняшней даты.
    - `category_id` — обязательное, должно существовать в таблице categories.
    3. Обработайте ошибки валидации и верните их обратно к форме, отображая сообщения об ошибках рядом с полями.
    4. Проверьте корректность работы валидации и убедитесь, что ошибки отображаются правильно.

    ### №4. Создание собственного класса запроса (Request)

    1. На втором этапе создайте собственный класс запроса для валидации формы задачи:
    - Используйте команду `php artisan make:request CreateTaskRequest`
    - В классе `CreateTaskRequest` определите правила валидации, аналогичные тем, что были в контроллере.
    - Обновите метод store контроллера `TaskController` для использования `CreateTaskRequest` вместо стандартного `Request`.
    2. Добавьте логику валидации для связанных данных
    -  Проверьте, что значение `category_id` действительно существует в базе данных, и оно принадлежит определенной категории.
    3. Убедитесь, что данные проходят валидацию через TaskRequest и что все ошибки корректно обрабатываются и возвращаются к форме.

    ### №5. Добавление флеш-сообщений

    1. Обновите HTML-форму для отображения подтверждающего сообщения об успешном сохранении задачи (флеш-сообщение).
    2. Обновите метод store контроллера `TaskController`, чтобы добавлять флеш-сообщение при успешном сохранении задачи.

    ### №6. Защита от CSRF

    1. Обеспечение безопасности данных в формах:
    - Добавьте директиву `@csrf` в форму для защиты от атаки **CSRF**.
    - Убедитесь, что форма отправляется только с помощью метода **POST**.

    ### №7. Обновление задачи

    1. Добавьте возможность редактирования задачи:
    1. Создайте форму для редактирования задачи.
    2. Создайте новый Request-класс `UpdateTaskRequest` с аналогичными правилами валидации.
    3. Создайте маршрут `GET /tasks/{task}/edit` и метод `edit` в контроллере `TaskController`.
    4. Создайте маршрут `PUT /tasks/{task}` для обновления задачи.
    5. Обновите метод `update` в контроллере `TaskController` для обработки данных из формы.

    ### Дополнительное задание

    1. Создайте кастомное правило валидации, проверяющее, что `description` не содержит запрещенные слова.
    2. Используйте Artisan-команду: `php artisan make:rule NoRestrictedWords`.
    3. римените это правило к полю description в классе `CreateTaskRequest`.

    ## Контрольные вопросы

    1. Что такое валидация данных и зачем она нужна?
    2. Как обеспечить защиту формы от CSRF-атак в Laravel?
    3. Как создать и использовать собственные классы запросов (Request) в Laravel?
    4. Как защитить данные от XSS-атак при выводе в представлении?