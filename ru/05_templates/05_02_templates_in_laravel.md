# Шаблонизатор в Laravel

В настоящее время существует множество шаблонизаторов, и каждый фреймворк предпочитает использовать определенный. Однако вы можете установить любой шаблонизатор по своему усмотрению.

В Laravel используется шаблонизатор **Blade**, который позволяет вставлять PHP-код прямо в шаблоны.

## Основы Blade

**Blade** — это шаблонизатор, который позволяет использовать PHP-код непосредственно в шаблонах. Он предоставляет удобные инструменты для работы с данными и их управлением.

Все шаблоны Blade компилируются в обычный PHP-код и кэшируются, что улучшает производительность. При изменении шаблона он автоматически перекомпилируется.

Например, чтобы вывести переменную, используются двойные фигурные скобки:

```blade
{{ $name }}
```

Итоговый скомпилированный PHP-код будет выглядеть примерно так:

```php
<?php echo e($name); ?>
```

## Создание шаблонов

Шаблоны создаются в директории `resources/views`. Все шаблоны должны иметь расширение `.blade.php`.

Пример шаблона `profile.blade.php`:

```blade
<!DOCTYPE html>
<html>
<head>
    <title>Профиль пользователя</title>
</head>
<body>
    <h1>Профиль пользователя</h1>
    <p>Имя: {{ $name }}</p>
    <p>Фамилия: {{ $surname }}</p>
    <p>Возраст: {{ $age }}</p>
</body>
</html>
```

## Рендеринг шаблонов

Для рендеринга шаблонов в Laravel используется метод `view()`. Он принимает два аргумента: имя шаблона и массив данных, которые будут переданы в шаблон.

Пример рендеринга шаблона `profile.blade.php`:

```php
Route::get('/profile', function () {
    return view('profile', [
        'name' => 'Иван',
        'surname' => 'Иванов',
        'age' => 25
    ]);
});
```

Когда происходит запрос к `/profile`, отобразится шаблон `profile.blade.php` с переданными данными.

Как вы можете заметить, при вызове метода `view()` не нужно указывать расширение `.blade.php`. Laravel автоматически добавляет его, так как все шаблоны должны иметь это расширение.

## Наименование шаблонов

В Laravel шаблоны рендерятся и подключаются достаточно часто, поэтому важно правильно их называть, чтобы они были легко идентифицируемы и понятны другим разработчикам.

### Рекомендации по наименованию шаблонов

В Laravel принято придерживаться следующих правил для наименования шаблонов:

- **Отражение содержимого:** Название шаблона должно точно описывать его содержимое. Например, для шаблона профиля пользователя лучше использовать имя `profile.blade.php`.
- **Использование дефисов:** Для разделения слов в именах шаблонов рекомендуется использовать дефисы, например, `user-profile.blade.php`.
- **Организация в папки:** Для упрощения структуры проекта и организации шаблонов, используйте папки, например, `users/profile.blade.php` для шаблона профиля пользователя.
- **Понятные имена:** Имена шаблонов должны быть легко запоминаемы и понятны всем разработчикам, работающим с проектом.

### Примеры хороших и плохих наименований

| Хорошие имена шаблонов    | Плохие имена шаблонов   |
| ------------------------- | ----------------------- |
| `profile.blade.php`       | `user.blade.php`        |
| `user-profile.blade.php`  | `userprofile.blade.php` |
| `users/profile.blade.php` | `userProfile.blade.php` |
| `posts/index.blade.php`   | `post.blade.php`        |
| `posts/show.blade.php`    | `POST.blade.php`        |

### Организация шаблонов

Шаблоны в Laravel обычно хранятся в директории `resources/views`. Для удобства и логичности рекомендуется группировать шаблоны по папкам.

Примеры организации:

- `resources/views/users` — для шаблонов, связанных с пользователями;
- `resources/views/posts` — для шаблонов, связанных с постами;
- `resources/views/layouts` — для шаблонов макетов (layouts);
- и так далее.

Это помогает поддерживать чистую структуру проекта и облегчает поиск нужных шаблонов.

### Наименование при подключении и рендеринге шаблонов

При подключении шаблонов в Laravel используется относительный путь от директории `resources/views`, без необходимости указывать полный путь к файлу. **Например**, если шаблон расположен по пути `resources/views/index.blade.php`, его можно подключить с помощью функции `view('index')`.

Если шаблон находится в подкаталоге, для разделения директорий используется точка (_точечная нотация_). Например:

- Шаблон `resources/views/users/profile.blade.php` рендерится как `view('users.profile')`.
- Шаблон `resources/views/posts/details/show.blade.php` рендерится как `view('posts.details.show')`.

Таким образом, точка заменяет символы `/` в пути, упрощая доступ к вложенным файлам шаблонов.

Этот подход упрощает управление шаблонами и делает проект более структурированным.

## Отображение переменных

Для отображения переменных в шаблоне используются двойные фигурные скобки:

```blade
Hello, {{ $name }}
```

Напомним, что данные передаются в шаблон в виде массива:

```php
return view('profile', [
    'name' => 'Иван',
    'surname' => 'Иванов',
    'age' => 25
]);
```

> [!NOTE]
> Выражения вывода `{{ }}` Blade автоматически отправляются через функцию htmlspecialchars PHP для предотвращения XSS-атак.

## Директивы Blade

**Директивы Blade** — это специальные инструкции, которые позволяют вставлять PHP-код в шаблоны, делая их более динамичными. Директивы являются удобными псевдонимами для PHP-кода, упрощая его использование в шаблонах.

### Директивы `@if` `ifelse` `@else` `@endif`

Директива `@if` позволяет выполнять условные операторы в шаблоне.

Синтаксис директивы `@if`:

```blade
@if (условие)
    // Код, который будет выполнен, если условие истинно
@else
    // Код, который будет выполнен, если условие ложно
@endif
```

Пример использования директивы `@if`:

```blade
@if ($name == 'Иван')
    <p>Привет, Иван!</p>
@else
    <p>Привет, гость!</p>
@endif
```

Использование директивы `@if` с `@elseif`:

```blade
@if ($fruit == 'apple')
    <p>Это яблоко</p>
@elseif ($fruit == 'banana')
    <p>Это банан</p>
@else
    <p>Это не яблоко и не банан</p>
@endif
```

### Директива `@unless`

Директива `@unless` выполняет код, если условие ложно.

Синтаксис директивы `@unless`:

```blade
@unless (условие)
    // Код, который будет выполнен, если условие ложно
@endunless
```

Пример использования директивы `@unless` для проверки, авторизован ли пользователь:

```blade
@unless (Auth::check())
    <p>Пожалуйста, войдите в систему</p>
@endunless
```

### Директива `@empty` и `@isset`

Директива `@empty` проверяет, пуста ли переменная, а `@isset` — определена ли переменная.

Пример использования директивы `@empty`:

```blade
@empty ($name)
    <p>Имя не указано</p>
@endempty
```

Синтаксис директивы `@isset`:

```blade
@isset ($name)
    <p>Имя: {{ $name }}</p>
@endisset
```

### Директивы авторизации `@auth` и `@guest`

Директива `@auth` проверяет, авторизован ли пользователь, а директива `@guest` — если пользователь не авторизован.

Пример использования директив:

```blade
@auth
    <p>Добро пожаловать, {{ Auth::user()->name }}</p>
@endauth

@guest
    <p>Пожалуйста, войдите в систему</p>
@endguest
```

### Директивы `@switch`, `@case`, `@default` и `@break`

Директива `@switch` используется для создания множественных условий.

Пример использования:

```blade
@switch($var)
    @case('value1')
        <!-- Код, который выполняется, если $var равно 'value1' -->
        @break

    @case('value2')
        <!-- Код, который выполняется, если $var равно 'value2' -->
        @break

    @default
        <!-- Код, который выполняется, если ни одно из условий не выполнено -->
@endswitch
```

### Директива `@class`

Одна из удобных директив Blade — `@class`, которая позволяет добавлять классы к HTML-элементам на основе условий.

Пример использования:

```blade
<div @class(['class1', 'class2' => $condition])>
    <!-- Код -->
</div>
```

Например,

````blade
<div @class(['bg-red' => true, 'text-white' => $isError])>
    <!-- Код -->
</div>

// Если $isError равно true, то элементу будет добавлен класс 'text-white'
// <div class="bg-red text-white"></div>
````



### Директива `@for`

Директива `@for` используется для создания циклов.

Пример использования:

```blade
@for ($i = 0; $i < 10; $i++)
    <p>Значение: {{ $i }}</p>
@endfor
````

### Директива `@foreach`

Директива `@foreach` используется для перебора массивов.

Пример использования:

```blade
@foreach ($posts as $post)
    <p>{{ $post->title }}</p>
    <p>{{ $post->content }}</p>
@endforeach
```

### Директива `@forelse` и `@empty`

Директива `@forelse` позволяет перебирать массивы и выводить сообщение, если массив пуст.

Пример использования:

```blade
@forelse ($posts as $post)
    <p>{{ $post->title }}</p>
    <p>{{ $post->content }}</p>
@empty
    <p>Посты не найдены</p>
@endforelse
```

### Директива `@while`

Директива `@while` используется для создания циклов.

Пример использования:

```blade
@while (true)
    <p>Бесконечный цикл</p>
@endwhile
```

### Переменная `loop` в директивах циклов

В циклических директивах Blade доступна переменная `loop`, которая предоставляет информацию о текущей итерации цикла.

Пример использования:

```blade
@foreach ($users as $user)
    @if ($loop->first)
        Это первая итерация.
    @endif

    @if ($loop->last)
        Это последняя итерация.
    @endif

    <p>Это пользователь {{ $user->id }}</p>
@endforeach
```

Переменная `loop` содержит множество полезных свойств:

- `loop->index` — индекс текущей итерации (начиная с 0).
- `loop->iteration` — порядковый номер текущей итерации (начиная с 1).
- `loop->count` — общее количество итераций.
- `loop->remaining` — количество оставшихся итераций.
- `loop->depth` — глубина вложенности цикла.
- `loop->parent` — ссылка на родительский цикл во вложенных циклах.
- `loop->first` — признак первой итерации.
- `loop->last` — признак последней итерации.

Эти свойства позволяют более гибко управлять логикой циклов в шаблонах.

### Встраивание PHP-кода

В редких случаях, когда необходимо встроить PHP-код в шаблон, можно использовать директиву `@php`. Однако, это не рекомендуется, так как чаще всего такая ситуация указывает на то, что логика должна быть вынесена в другой слой приложения.

Пример использования:

```blade
@php
    $name = 'Иван';
    echo $name;
@endphp
```

### Комментарии

Blade поддерживает комментарии, которые не будут отображаться в итоговом HTML-коде.

Однострочный комментарий:

```blade
{{-- Это комментарий --}}
```

## Рендеринг PHP классов

Для рендеринга PHP классов в шаблонах Blade используется стрелочная нотация `->`.

Пример использования:

```php
// ...
$user = new User();
$user->name = 'Иван';

return view('profile', ['user' => $user]);
```


```blade
{{ $user->name }}
```

## Пример использования Blade

Давайте рассмотрим пример использования Blade для:

1. страницы со списком постов
2. отдельной страницы для каждого поста.

### Список постов

Контроллер `PostController.php`:

```php
namespace App\Http\Controllers;

class PostController extends Controller
{
    public function index()
    {
        $posts = [
            ['title' => 'Пост 1', 'content' => 'Содержимое поста 1'],
            ['title' => 'Пост 2', 'content' => 'Содержимое поста 2'],
            ['title' => 'Пост 3', 'content' => 'Содержимое поста 3']
        ];

        return view('posts', ['posts' => $posts]);
    }
}
```

Шаблон `posts.blade.php`:

```blade
<!DOCTYPE html>
<html>
<head>
    <title>Посты</title>
</head>
<body>
    <h1>Посты</h1>
    @forelse ($posts as $post)
        <h2>{{ $post['title'] }}</h2>
        <p>{{ $post['content'] }}</p>
    @empty
        <p>Посты не найдены</p>
    @endforelse
</body>
</html>
```

### Отдельный пост

Контроллер `PostController.php`:

```php
namespace App\Http\Controllers;

class PostController extends Controller
{
    public function show($id)
    {
        // Получение поста по ID
        // Например, из базы данных
        $post = [
            'title' => 'Пост ' . $id,
            'content' => 'Содержимое поста ' . $id
        ];

        return view('post', ['post' => $post]);
    }
}
```

Шаблон `post.blade.php`:

```blade
<!DOCTYPE html>
<html>
<head>
    <title>{{ $post['title'] }}</title>
</head>
<body>
    <h1>{{ $post['title'] }}</h1>
    <p>{{ $post['content'] }}</p>
</body>
</html>
```
