# Шаблонизатор в Laravel

В настоящее время существует множество шаблонизаторов, и каждый фреймворк предпочитает использовать определенный. Однако вы можете установить любой шаблонизатор по своему усмотрению.

В Laravel используется шаблонизатор **Blade**, который позволяет вставлять PHP-код прямо в шаблоны.

## Основы Blade

**Blade** — это шаблонизатор, который позволяет использовать PHP-код непосредственно в шаблонах. Он предоставляет удобные инструменты для работы с данными и их управлением.

Все шаблоны Blade компилируются в обычный PHP-код и кэшируются, что улучшает производительность. При изменении шаблона он автоматически перекомпилируется.

Например, чтобы вывести переменную, используются двойные фигурные скобки:

```php
{{ $name }}
```

Итоговый скомпилированный PHP-код будет выглядеть примерно так:

```php
<?php echo e($name); ?>
```

## Создание шаблонов

Шаблоны создаются в директории `resources/views`. Все шаблоны должны иметь расширение `.blade.php`.

Пример шаблона `profile.blade.php`:

```php
<!DOCTYPE html>
<html>
<head>
    <title>Профиль пользователя</title>
</head>
<body>
    <h1>Профиль пользователя</h1>
    <p>Имя: {{ $name }}</p>
    <p>Фамилия: {{ $surname }}</p>
    <p>Возраст: {{ $age }}</p>
</body>
</html>
```

## Рендеринг шаблонов

Для рендеринга шаблонов в Laravel используется метод `view()`. Он принимает два аргумента: имя шаблона и массив данных, которые будут переданы в шаблон.

Пример рендеринга шаблона `profile.blade.php`:

```php
Route::get('/profile', function () {
    return view('profile', [
        'name' => 'Иван',
        'surname' => 'Иванов',
        'age' => 25
    ]);
});
```

Когда происходит запрос к `/profile`, отобразится шаблон `profile.blade.php` с переданными данными.

Как вы можете заметить, при вызове метода `view()` не нужно указывать расширение `.blade.php`. Laravel автоматически добавляет его, так как все шаблоны должны иметь это расширение.

## Отображение переменных

Для отображения переменных в шаблоне используются двойные фигурные скобки:

```php
Hello, {{ $name }}
```

Напомним, что данные передаются в шаблон в виде массива:

```php
return view('profile', [
    'name' => 'Иван',
    'surname' => 'Иванов',
    'age' => 25
]);
```

> [!NOTE]
> Выражения вывода `{{ }}` Blade автоматически отправляются через функцию htmlspecialchars PHP для предотвращения XSS-атак.

## Директивы Blade

**Директивы Blade** — это специальные инструкции, которые позволяют вставлять PHP-код в шаблоны, делая их более динамичными. Директивы являются удобными псевдонимами для PHP-кода, упрощая его использование в шаблонах.

### Директивы `@if` `ifelse` `@else` `@endif`

Директива `@if` позволяет выполнять условные операторы в шаблоне.

Синтаксис директивы `@if`:

```php
@if (условие)
    // Код, который будет выполнен, если условие истинно
@else
    // Код, который будет выполнен, если условие ложно
@endif
```

Пример использования директивы `@if`:

```php
@if ($name == 'Иван')
    <p>Привет, Иван!</p>
@else
    <p>Привет, гость!</p>
@endif
```

Использование директивы `@if` с `@elseif`:

```php
@if ($fruit == 'apple')
    <p>Это яблоко</p>
@elseif ($fruit == 'banana')
    <p>Это банан</p>
@else
    <p>Это не яблоко и не банан</p>
@endif
```

### Директива `@unless`

Директива `@unless` выполняет код, если условие ложно.

Синтаксис директивы `@unless`:

```php
@unless (условие)
    // Код, который будет выполнен, если условие ложно
@endunless
```

Пример использования директивы `@unless` для проверки, авторизован ли пользователь:

```php
@unless (Auth::check())
    <p>Пожалуйста, войдите в систему</p>
@endunless
```

### Директива `@empty` и `@isset`

Директива `@empty` проверяет, пуста ли переменная, а `@isset` — определена ли переменная.

Пример использования директивы `@empty`:

```php
@empty ($name)
    <p>Имя не указано</p>
@endempty
```

Синтаксис директивы `@isset`:

```php
@isset ($name)
    <p>Имя: {{ $name }}</p>
@endisset
```

### Директивы авторизации `@auth` и `@guest`

Директива `@auth` проверяет, авторизован ли пользователь, а директива `@guest` — если пользователь не авторизован.

Пример использования директив:

```php
@auth
    <p>Добро пожаловать, {{ Auth::user()->name }}</p>
@endauth

@guest
    <p>Пожалуйста, войдите в систему</p>
@endguest
```

### Директивы `@switch`, `@case`, `@default` и `@break`

Директива `@switch` используется для создания множественных условий.

Пример использования:

```php
@switch($var)
    @case('value1')
        <!-- Код, который выполняется, если $var равно 'value1' -->
        @break

    @case('value2')
        <!-- Код, который выполняется, если $var равно 'value2' -->
        @break

    @default
        <!-- Код, который выполняется, если ни одно из условий не выполнено -->
@endswitch
```

### Директива `@for`

Директива `@for` используется для создания циклов.

Пример использования:

```php
@for ($i = 0; $i < 10; $i++)
    <p>Значение: {{ $i }}</p>
@endfor
```

### Директива `@foreach`

Директива `@foreach` используется для перебора массивов.

Пример использования:

```php
@foreach ($posts as $post)
    <p>{{ $post->title }}</p>
    <p>{{ $post->content }}</p>
@endforeach
```

### Директива `@forelse` и `@empty`

Директива `@forelse` позволяет перебирать массивы и выводить сообщение, если массив пуст.

Пример использования:

```php
@forelse ($posts as $post)
    <p>{{ $post->title }}</p>
    <p>{{ $post->content }}</p>
@empty
    <p>Посты не найдены</p>
@endforelse
```

### Директива `@while`

Директива `@while` используется для создания циклов.

Пример использования:

```php
@while (true)
    <p>Бесконечный цикл</p>
@endwhile
```

### Переменная `loop` в директивах циклов

В циклических директивах Blade доступна переменная `loop`, которая предоставляет информацию о текущей итерации цикла.

Пример использования:

```php
@foreach ($users as $user)
    @if ($loop->first)
        Это первая итерация.
    @endif

    @if ($loop->last)
        Это последняя итерация.
    @endif

    <p>Это пользователь {{ $user->id }}</p>
@endforeach
```

Переменная `loop` содержит множество полезных свойств:

- `loop->index` — индекс текущей итерации (начиная с 0).
- `loop->iteration` — порядковый номер текущей итерации (начиная с 1).
- `loop->count` — общее количество итераций.
- `loop->remaining` — количество оставшихся итераций.
- `loop->depth` — глубина вложенности цикла.
- `loop->parent` — ссылка на родительский цикл во вложенных циклах.
- `loop->first` — признак первой итерации.
- `loop->last` — признак последней итерации.

Эти свойства позволяют более гибко управлять логикой циклов в шаблонах.

### Встраивание PHP-кода

В редких случаях, когда необходимо встроить PHP-код в шаблон, можно использовать директиву `@php`. Однако, это не рекомендуется, так как чаще всего такая ситуация указывает на то, что логика должна быть вынесена в другой слой приложения.

Пример использования:

```php
@php
    $name = 'Иван';
    echo $name;
@endphp
```

### Комментарии

Blade поддерживает комментарии, которые не будут отображаться в итоговом HTML-коде.

Однострочный комментарий:

```php
{{-- Это комментарий --}}
```

## Пример использования Blade

Давайте рассмотрим пример использования Blade для:

1. страницы со списком постов
2. отдельной страницы для каждого поста.

### Список постов

Контроллер `PostController.php`:

```php
namespace App\Http\Controllers;

class PostController extends Controller
{
    public function index()
    {
        $posts = [
            ['title' => 'Пост 1', 'content' => 'Содержимое поста 1'],
            ['title' => 'Пост 2', 'content' => 'Содержимое поста 2'],
            ['title' => 'Пост 3', 'content' => 'Содержимое поста 3']
        ];

        return view('posts', ['posts' => $posts]);
    }
}
```

Шаблон `posts.blade.php`:

```php
<!DOCTYPE html>
<html>
<head>
    <title>Посты</title>
</head>
<body>
    <h1>Посты</h1>
    @forelse ($posts as $post)
        <h2>{{ $post['title'] }}</h2>
        <p>{{ $post['content'] }}</p>
    @empty
        <p>Посты не найдены</p>
    @endforelse
</body>
</html>
```

### Отдельный пост

Контроллер `PostController.php`:

```php
namespace App\Http\Controllers;

class PostController extends Controller
{
    public function show($id)
    {
        // Получение поста по ID
        // Например, из базы данных
        $post = [
            'title' => 'Пост ' . $id,
            'content' => 'Содержимое поста ' . $id
        ];

        return view('post', ['post' => $post]);
    }
}
```

Шаблон `post.blade.php`:

```php
<!DOCTYPE html>
<html>
<head>
    <title>{{ $post['title'] }}</title>
</head>
<body>
    <h1>{{ $post['title'] }}</h1>
    <p>{{ $post['content'] }}</p>
</body>
</html>
```